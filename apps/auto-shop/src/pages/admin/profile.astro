---
import { env } from "cloudflare:workers";
import Layout from "@/layouts/Layout.astro";
import { ProfileForm } from "@/components/ProfileForm";
import { getDb, profile as profileTable } from "@/db";

const db = getDb(env.DB);
const profileResult = await db.select().from(profileTable).limit(1);
const profile = profileResult[0] || { name: "Auto Shop" };
---

<Layout title="Edit Profile" isAdmin>
  <div class="space-y-6">
    <div class="flex justify-between items-center">
      <h1 class="text-3xl font-black">Edit Profile</h1>
      <a href="/admin" class="btn btn-ghost btn-sm gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
        Back to Dashboard
      </a>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <ProfileForm profile={profile} client:load />
      </div>
    </div>
  </div>
</Layout>
