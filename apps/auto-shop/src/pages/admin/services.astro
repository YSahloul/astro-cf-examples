---
import { env } from "cloudflare:workers";
import Layout from "@/layouts/Layout.astro";
import { ServicesManager } from "@/components/ServicesManager";
import { getDb, services as servicesTable } from "@/db";
import { asc, desc } from "drizzle-orm";

const db = getDb(env.DB);
const services = await db.select().from(servicesTable).orderBy(desc(servicesTable.featured), asc(servicesTable.sortOrder));
---

<Layout title="Manage Services" isAdmin>
  <div class="space-y-6">
    <div class="flex justify-between items-center">
      <h1 class="text-3xl font-black">Manage Services</h1>
      <a href="/admin" class="btn btn-ghost btn-sm gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
        Back to Dashboard
      </a>
    </div>
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <ServicesManager initialServices={services} client:load />
      </div>
    </div>
  </div>
</Layout>
